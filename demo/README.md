# 天命：AI君主模拟器 - 最小可运行Demo

## 项目概述

《天命：AI君主模拟器》是一款基于AI技术的古风策略游戏，玩家将扮演一位古代君主，通过与AI顾问互动，管理国家资源，应对各种事件，实现国家的繁荣昌盛。

本项目实现了一个最小可运行Demo，包含完整的游戏循环和AI交互功能。

## 架构设计

项目采用分层架构设计，严格按照以下四层结构实现：

### 1. 世界层（数值系统）
- 定义世界初始数值
- 实现每回合自动运行逻辑
- 实现事件触发规则

### 2. NPC Agent层（吏部尚书）
- 定义NPC Agent类
- 实现观察世界（读取数值）
- 实现思考决策（根据粮食/民心决定上奏内容）
- 实现行动（调用LLM API生成奏折）

### 3. 叙事Agent层（数值→剧情翻译）
- 定义叙事Agent
- 实现输入（世界状态 + NPC上奏内容）
- 实现输出（古风剧情旁白）
- 内部调用LLM生成

### 4. 主控循环（游戏跑起来）
- 编写主循环
- 实现游戏流程：世界运行→NPC行动→叙事生成→玩家选择→数值修改→循环

## 技术实现

### 核心技术
- **JavaScript**：使用Node.js运行环境
- **AI集成**：集成豆包API生成古风内容
- **模块化设计**：分层架构，各模块职责清晰
- **异步处理**：使用async/await处理异步操作
- **错误处理**：完善的错误处理机制，确保API调用失败时游戏仍能运行

### 文件结构

```
demo/
├── world.js          # 世界层 - 数值系统
├── npc_agent.js      # NPC Agent层 - 吏部尚书
├── narrative_agent.js # 叙事Agent层 - 数值→剧情翻译
├── main.js           # 主控循环 - 游戏主逻辑
└── README.md         # 项目说明文档
```

## 功能说明

### 世界层
- **初始数值**：时间、银两、粮食、民心
- **自动运行**：每回合粮食-10，银两+5，时间更新
- **事件触发**：粮食<30→粮荒；民心<40→民变；否则→太平

### NPC Agent
- **初始化**：身份、性格、目标、记忆
- **观察**：读取世界数值
- **思考**：根据粮食/民心决定上奏内容
- **行动**：调用豆包API生成正式奏折

### 叙事Agent
- **输入**：世界状态 + NPC上奏内容
- **输出**：古风剧情旁白
- **生成**：调用豆包API生成生动的剧情描述

### 主控循环
1. 世界运行一回合
2. 吏部Agent观察→思考→行动
3. 叙事Agent生成剧情
4. 打印剧情
5. 玩家选择（赈灾/加税）
6. 修改数值
7. 循环

## 运行指南

### 环境要求
- Node.js 14.0+ 
- 互联网连接（用于API调用）

### 运行步骤
1. **进入目录**：
   ```bash
   cd "E:\Data\Documents\wechat\xwechat_files\wxid_gmss7tyj72b922_739e\msg\file\2026-02\game (2)\demo"
   ```

2. **安装依赖**（如果需要）：
   ```bash
   npm install node-fetch
   ```

3. **运行游戏**：
   ```bash
   node main.js
   ```

### API配置

本项目使用豆包API生成内容，API Key已配置在代码中：
- **API Key**：`e5d3732f-691b-4eae-86c4-2cc7f99a36cf`
- **模型**：`doubao-1-5-pro-32k-250115`
- **端点**：`https://ark.cn-beijing.volces.com/api/v3/chat/completions`

## 游戏示例

### 运行截图

```
=====================================
回合开始
=====================================

1. 世界运行一回合
世界状态: { '时间': '第1年 2月', '银两': 105, '粮食': 15, '民心': 60 }
事件: 粮荒

2. 吏部Agent观察→思考→行动
[LLM] 生成奏折中...
[LLM] Prompt: 你是吏部尚书，正在向皇帝上奏。请根据以下内容生成一份正式的奏折：
启奏陛下，当前粮食储备仅余15石，已不足维持百姓生计，恐生粮荒之变，请陛下定夺。
吏部尚书奏折: # 奏粮荒事折
臣吏部尚书[姓名]诚惶诚恐，稽首顿首，谨奏于陛下。

伏惟陛下圣明，俯察下情。近日臣察得，国库粮食储备仅余十五石，已不足维持百姓生计，若不及时采取措施，恐生粮荒之变，危及社稷安宁。

臣以为，当务之急，需开仓放粮，赈济灾民，同时遣使赴产粮之地采购粮食，以解燃眉之急。此外，应鼓励百姓开垦荒地，兴修水利，以增加粮食产量，从根本上解决粮荒问题。

臣谨具折上奏，伏乞陛下圣裁。

[具体日期]

3. 叙事Agent生成剧情

4. 剧情旁白:
时维第1年2月，春寒料峭，万物待苏。然国库之中，粮食仅余十五石，已不足维持百姓生计，粮荒之危，如悬剑于顶。

吏部尚书[姓名]闻此消息，忧心如焚，连夜具折上奏。折言，国库粮食储备告急，若不及时处置，恐生民变，危及社稷。尚书恳请陛下开仓放粮，赈济灾民，同时遣使采购粮食，鼓励垦荒兴修水利，以解粮荒之困。

皇帝览奏，眉头紧锁，深知此事干系重大。国家初立，百废待兴，粮荒若起，后果不堪设想。

5. 玩家选择
请选择您的决策:
1. 赈灾（粮食+20，银两-30）
2. 加税（银两+20，民心-10）
3. 什么都不做
您选择了: 1

6. 修改数值
执行赈灾: 粮食+20，银两-30
更新后的世界状态: { '时间': '第1年 2月', '银两': 75, '粮食': 35, '民心': 60 }

=====================================
回合结束
=====================================
```

## 后续扩展建议

### 功能扩展
1. **更多事件类型**：添加自然灾害、外交事件、军事冲突等
2. **更多NPC类型**：添加户部、兵部、礼部等不同部门的NPC
3. **更复杂的决策系统**：增加更多决策选项和影响
4. **科技树系统**：实现科技研发和解锁
5. **外交系统**：与其他国家的互动

### 技术优化
1. **API调用优化**：实现缓存机制，减少API调用次数
2. **用户输入**：使用readline模块获取真实的用户输入
3. **图形界面**：使用HTML/CSS/JS创建简单的图形界面
4. **多语言支持**：添加多语言版本
5. **保存/加载系统**：实现游戏存档功能

### AI增强
1. **个性化AI**：为不同NPC设置不同的性格和行为模式
2. **记忆系统**：实现NPC的长期记忆，影响决策
3. **情感系统**：添加NPC的情感变化
4. **多模型集成**：根据不同场景使用不同的AI模型

## 总结

《天命：AI君主模拟器》最小可运行Demo已成功实现，包含完整的游戏循环和AI交互功能。通过分层架构设计，实现了世界层、NPC Agent层、叙事Agent层和主控循环的有机结合，使用豆包API生成高质量的古风内容，为玩家提供了沉浸式的游戏体验。

本项目展示了如何将AI技术与游戏开发相结合，创造出具有智能交互能力的游戏系统。通过后续的扩展和优化，可以进一步提升游戏的深度和可玩性，打造出一款完整的AI君主模拟游戏。